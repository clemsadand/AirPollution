# Air Pollution Modelling with PINN and CR-FEM

## Description

This project study the modeling of air pollution using the advection-diffusion equations in a bounded two-dimensional domain. It implements and compares two numerical methods for solving time-dependent advection-diffusion equations:
1.  **Physics-Informed Neural Networks (PINN)**: A deep learning approach where a neural network is trained to satisfy the PDE, initial conditions, and boundary conditions.
2.  **Crouzeix-Raviart Finite Element Method (CR-FEM)**: A classical finite element approach using Crouzeix-Raviart elements and a Backward Euler time-stepping scheme.

The project includes scripts for running experiments to compare the accuracy and performance of these methods.

## Features

-   Implementation of CR-FEM for 2D advection-diffusion problems.
-   Implementation of PINNs for 2D advection-diffusion problems.
-   Mesh generation for FEM using the Gmsh Python API.
-   Latin Hypercube Sampling for generating collocation points in PINNs.
-   Experiment scripts (e.g., `experiments/crbe_experiments.py`, `experiments/pinn_experiments.py`) for systematic comparison.
-   Solution visualization and error analysis (L2 error, max error).
-   Early stopping and learning rate scheduling for PINN training.
-   Support for different activation functions in PINN (Tanh, Sine, Swish).

## Methodologies

### Physics-Informed Neural Networks (PINN)

PINNs leverage deep neural networks to approximate the solution of PDEs. The network takes spatio-temporal coordinates (x, y, t) as input and outputs the concentration c(x,y,t). The training process minimizes a composite loss function that includes:
1.  The PDE residual over a set of collocation points in the domain.
2.  The error in satisfying initial conditions.
3.  The error in satisfying boundary conditions.

The `src/pinn.py` script defines the PINN architecture, training loop, and evaluation methods. Shared classes like `Problem` and `Domain` are defined in `src/common.py`.

Key components:
-   `Problem` (in `src/common.py`): Defines the analytical solution, initial, and boundary conditions.
-   `Domain` (in `src/common.py`): Specifies the physical domain parameters.
-   `PINN` (in `src/pinn.py`): Defines the neural network architecture, methods for computing the PDE residual, and the training loop.
-   `EarlyStopping` (in `src/pinn.py`): Utility to prevent overfitting.
-   Helper functions for sampling collocation points (LHS) and computing gradients.


### Crouzeix-Raviart Finite Element Method (CR-FEM)

The CR-FEM approach discretizes the spatial domain using a triangular mesh. The concentration variable is approximated by piecewise linear functions that are continuous at the midpoints of element edges (Crouzeix-Raviart elements). A Backward Euler scheme is used for time discretization. The `src/crbe.py` script handles mesh creation, matrix assembly, solution, and error computation. Shared classes like `Problem` and `Domain` are defined in `src/common.py`.

Key components:
-   `create_mesh()` (in `src/crbe.py`): Generates a square mesh using `gmsh`.
-   `Problem` (in `src/common.py`): Defines the analytical solution, initial conditions, boundary conditions, and source term.
-   `Domain` (in `src/common.py`): Specifies the physical domain parameters.
-   `MeshData` (in `src/crbe.py`): Stores and processes mesh information.
-   `ElementCR` (in `src/crbe.py`): Defines properties of the Crouzeix-Raviart reference element.
-   `BESCRFEM` (in `src/crbe.py`): Implements the Backward Euler Scheme with CR-FEM, including matrix assembly, solving the linear system, and computing errors.

## File Structure

-   `src/`: Contains the core solver implementations.
    -   `src/pinn.py`: Implementation of the Physics-Informed Neural Network solver.
    -   `src/crbe.py`: Implementation of the Crouzeix-Raviart Finite Element Method solver.
    -   `src/common.py`: Contains common class definitions like `Problem`, `Domain`, and `AdDifProblem`, used by both `pinn.py` and `crbe.py`.
-   `experiments/`: Contains scripts for running various experiments, comparisons, and hyperparameter searches (e.g., `pinn_experiments.py`, `crbe_experiments.py`, `fixed_runtime_experiments.py`, `optimal_hyperparams_search.py`).
-   `scripts/`: Contains utility or specific problem scripts.
    -   `scripts/problem1.py`: Example script demonstrating a specific problem setup (Problem 1 from a source).
-   `requirements.txt`: Lists the Python dependencies for the project.
-   `README.md`: This file.
-   `experimental_results/`: (Generated directory) Stores CSV files with results from experiment scripts (typically generated by scripts in `experiments/`).
-   `results/`: (Generated directory) Stores plots from individual solver runs (typically generated by scripts in `src/` if run directly, or by specific experiment scripts).

## Installation

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/clemsadand/AirPollution.git
    cd AirPollution
    ```
2.  **Create a virtual environment (optional but recommended):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows use `venv\Scripts\activate`
    ```
3.  **Install dependencies:**
    ```bash
    sudo apt-get update
    sudo apt-get install -y libglu1-mesa # additional packages for gmsh on Linux
    pip install -r requirements.txt
    ```
4.  **Gmsh:** This project uses `gmsh` for mesh generation. If it's not installed correctly via pip or if you encounter issues, you might need to install it system-wide. Please refer to the [official Gmsh website](https://gmsh.info/) for installation instructions.
5.  **PYTHONPATH (Important for running scripts):**
    To ensure scripts in `experiments/` and `scripts/` can correctly import modules from the `src/` directory, add the project's root directory to your `PYTHONPATH`:
    ```bash
    export PYTHONPATH=/path/to/your/AirPollution:$PYTHONPATH
    ```
    Replace `/path/to/your/AirPollution` with the actual path to the cloned repository. Alternatively, you can run scripts as modules from the root directory, e.g., `python -m experiments.pinn_experiments`.

## Usage

### Running Individual Solvers (Mainly for Development/Debugging)

The core solver scripts in `src/` can be run directly if they have a `if __name__ == "__main__":` block. This is typically for development or quick tests.

-   **CR-FEM Solver:**
    ```bash
    python src/crbe.py
    ```
-   **PINN Solver:**
    ```bash
    python src/pinn.py
    ```

### Running Experiments (Primary Usage)

The experiment scripts in the `experiments/` directory are the primary way to run simulations and generate results:
-   **PINN Experiments:**
    ```bash
    python experiments/pinn_experiments.py
    ```
    (Adjust parameters within the script or use command-line arguments if implemented by the script).
-   **CR-FEM Experiments:**
    ```bash
    python experiments/crbe_experiments.py
    ```
-   **Other Experiments:**
    Refer to individual scripts within the `experiments/` directory for their specific purpose and how to run them, e.g.:
    ```bash
    python experiments/fixed_runtime_experiments.py
    python experiments/optimal_hyperparams_search.py --width 32 --n_trials 50 --epochs 1000
    ```

### Running Scripts
-   **Problem 1 Script:**
    ```bash
    python scripts/problem1.py
    ```

Ensure your `PYTHONPATH` is set as described in the "Installation" section, or run scripts as modules (e.g., `python -m scripts.problem1`) if you encounter import errors.
